ARG TEXTSCOPE_BASE_IMAGE_VERSION
ARG UBUNTU_VERSION
ARG POETRY_VERSION

FROM docker.lomin.ai/ts-web-base:${TEXTSCOPE_BASE_IMAGE_VERSION}

ENV PATH="/root/.local/bin:${PATH}"
ENV PYTHONPATH="$PYTHONPATH:/workspace"

USER 0

COPY ./app /workspace/app
COPY ./assets/thales/ /workspace/assets/thales
COPY ./.env /workspace/.env
COPY ./requirements/web/pyproject.toml /workspace/
COPY ./requirements/web/poetry.lock /workspace/

RUN pip3 install nuitka==0.6.19.6

WORKDIR /workspace
RUN mv app/main.py ./main.py && \
    python3 -m nuitka --module app --include-package=app

RUN rm -rf /workspace/app /workspace/*.build /workspace/*.txt /workspace/Nuitka /workspace/assets && \
    rm -f /workspace/pyproject.toml /workspace/poetry.lock && \
    rm -rf /var/lib/apt/lists/*
